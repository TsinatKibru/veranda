generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String    @id @default(cuid())
  name         String
  email        String    @unique
  role         Role      @default(CLIENT)
  companyName  String?
  contactInfo  String?
  passwordHash String
  requests     Request[]
  messages     Message[]
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
}

enum Role {
  ADMIN
  CLIENT
}

model Category {
  id            String    @id @default(cuid())
  name          String
  description   String?
  imageUri      String?
  isActive      Boolean   @default(true)
  categoryOrder Int?
  products      Product[]
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Material {
  id          String    @id @default(cuid())
  name        String
  description String?
  imageUri    String?
  products    Product[]
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model Product {
  id                 String    @id @default(cuid())
  name               String
  description        String?
  categoryId         String?
  materialId         String?
  imageUri           String?
  productImageUrls   String[]
  specs              Json?
  priceRange         String?
  availability       Boolean   @default(true)
  stock              Int       @default(0)
  category           Category? @relation(fields: [categoryId], references: [id])
  material           Material? @relation(fields: [materialId], references: [id])
  requests           Request[]
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
}

model Request {
  id          String        @id @default(cuid())
  userId      String
  productId   String
  quantity    Int?
  customSpecs Json?
  status      RequestStatus @default(PENDING)
  notes       String?
  user        User          @relation(fields: [userId], references: [id])
  product     Product       @relation(fields: [productId], references: [id])
  messages    Message[]
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
}

enum RequestStatus {
  PENDING
  QUOTED
  APPROVED
  REJECTED
}

model Message {
  id         String   @id @default(cuid())
  requestId  String
  fromUserId String
  content    String
  request    Request  @relation(fields: [requestId], references: [id])
  fromUser   User     @relation(fields: [fromUserId], references: [id])
  createdAt  DateTime @default(now())
}
